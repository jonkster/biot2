<button (click)="addTestNode();">Add Test Node</button>
<button *ngIf="!getCommunicationStatus()" (click)="resetService();">Retry Router Detection</button>
<button (click)="dropNodes();">Redraw Nodes</button><br/>
<span>
    <input type="radio" name="nodeView" value="raw" (click)="setNodeView('raw')" [(ngModel)]="nodeView">Data View
    <input type="radio" name="nodeView" value="limb" (click)="setNodeView('limb')" [(ngModel)]="nodeView">Limb View
</span>
<div appThreed [displaywidth]="1400" [displayheight]="400" class="centred"></div>
<div appThreestats [statsstyle]="{position: 'inherit', float: 'left', display: 'flex'}"></div>
<hr/>
<span>
    Auto Zoom
    <input type="radio" name="autozoom" value="1" (click)="autoZoom = 1" [(ngModel)]="autoZoom">On
    <input type="radio" name="autozoom" value="0" (click)="autoZoom = 0" [(ngModel)]="autoZoom">Off
</span>

<span>Router 
        <span *ngIf="!getCommunicationStatus()"> NOT </span>
        Detected
</span>

<div>
    <table *ngIf="nodeView === 'raw'">
        <tr>
            <th>colour</th>
            <th>#</th>
            <th>address</th>
            <th>name</th>
            <th>time-stamp</th>
            <th>last-heard</th>
            <th>delay</th>
            <th>x</th>
            <th>y</th>
            <th>z</th>
            <th class="w10em">quat x</th>
            <th class="w10em">quat y</th>
            <th class="w10em">quat z</th>
            <th class="w10em">quat w</th>
            <th class="w20em">calibration</th>
            <th>auto<br/>calibrate<br/>mode</th>
            <th>LED mode</th>
            <th>DOF</th>
            <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
        </tr>
        <ng-template ngFor let-address [ngForOf]="nodeAddresses" let-i="index">
            <tr (click)="openNodeControl(address)" [class.selectedTop]="selectedNodeAddress === address">
            <td [style.background-color]="nodeData[address].colour">&nbsp;</td>
            <td>#{{ i }}</td>
            <td [style.color]="nodeData[address].colour">{{ address }}</td>
            <td>{{ nodeData[address].name }}</td>
            <td>{{ nodeData[address].timeStamp }}</td>
            <td>{{ nodeData[address].lasttime }}</td>
            <td  [class.bad]="nodeData[address].lastHeardSame >= 3">{{ nodeData[address].lastHeardSame }}</td>
            <td>{{ nodeData[address].position[0] }}</td>
            <td>{{ nodeData[address].position[1] }}</td>
            <td>{{ nodeData[address].position[2] }}</td>
            <td>{{ nodeData[address].quaternion.x }}</td>
            <td>{{ nodeData[address].quaternion.y }}</td>
            <td>{{ nodeData[address].quaternion.z }}</td>
            <td>{{ nodeData[address].quaternion.w }}</td>
            <td>{{ nodeData[address].calibration }}</td>
            <td>{{ nodeData[address].auto }}</td>
            <td>{{ nodeData[address].led }}</td>
            <td>{{ nodeData[address].dof }}</td>
            <td [style.background-color]="nodeData[address].colour">&nbsp;</td>
        </tr>
        <tr *ngIf="selectedNodeAddress === address" [class.selectedBottom]="selectedNodeAddress === address">
            <td [style.background-color]="nodeData[address].colour">&nbsp;</td>
            <td>&nbsp;</td>
            <td>
                <button class="btn btn-primary" (click)="alertNode(address)">Identify Node</button>
            </td>
            <td>
                <button class="btn btn-primary" (click)="nameNode(address)">Rename Node</button>
            </td>
            <td>
                <button class="btn btn-primary" [disabled]="recordingActive[address]" (click)="recordNode(address)">Record Node</button>
                <button class="btn btn-success" [disabled]="recordingActive[address] || (! hasRecording(address))" (click)="getNodeRecording(address)">Analyse Recording</button>
                <button class="btn btn-success" [disabled]="recordingActive[address] || (! hasRecording(address))" (click)="replayNodeRecording(address)">Replay Recording</button>
                <span *ngIf="recordingActive[address]" class="btn btn-danger">Recording...</span>
            </td>
            <td colspan="8">&nbsp;</td>
            <td colspan="2">
                <input type="radio" name="calibrate2" value="0" (click)="setCalibrateMode(address)" [(ngModel)]="selectedNodeCalMode">Stop Calibration<br/>
                <input type="radio" name="calibrate2" value="1" (click)="setCalibrateMode(address)" [(ngModel)]="selectedNodeCalMode">Calibration On<br/>
                <input type="radio" name="calibrate2" value="2" (click)="setCalibrateMode(address)" [(ngModel)]="selectedNodeCalMode">Reset and Restart Calibration<br/>
                <input type="radio" name="calibrate2" value="3" (click)="setCalibrateMode(address)" [(ngModel)]="selectedNodeCalMode">Reset and Stop Calibration<br/>
            </td>
            <td colspan="2">&nbsp;</td>
            <td [style.background-color]="nodeData[address].colour">&nbsp;</td>
        </tr>
        </ng-template>
    </table>
    <table *ngIf="nodeView === 'limb'">
        <tr>
            <th>colour</th>
            <th>#</th>
            <th>address</th>
            <th>name</th>
            <th>limb</th>
            <th>length</th>
            <th>position</th>
            <th>parent limb</th>
            <th>&nbsp;</th>
        </tr>
        <ng-template ngFor let-address [ngForOf]="nodeAddresses" let-i="index">
            <tr (click)="openLimbControl(address)" [class.selectedTop]="selectedNodeAddress === address">
            <td [style.background-color]="nodeData[address].colour">&nbsp;</td>
            <td>#{{ i }}</td>
            <td [style.color]="nodeData[address].colour">{{ address }}</td>
            <td>{{ nodeData[address].limb.name }}</td>
            <td>{{ nodeData[address].limb.limbModel }}</td>
            <td>{{ nodeData[address].limb.limbLength }}</td>
            <td>{{ showPosition(nodeData[address].limb.position) }}</td>
            <td>{{ nodeData[address].limb.parentLimbName }}</td>
            <td [style.background-color]="nodeData[address].colour">&nbsp;</td>
        </tr>
        </ng-template>
    </table>
    <div class="debug" #debugHolder [scrollTop]="debugHolder.scrollHeight">
        <div *ngFor="let txt of debugHistory; let i = index" >{{ i }} : {{ txt }}</div>
    </div>
</div>

<app-dialog #nodeRenameDialog>
    <div class="app-modal-header">
        Rename Node: <b>{{ selectedNodeAddress }}</b>
    </div>
    <div class="app-modal-body">
        <span>Current Name: {{ selectedNodeName}}</span>
        <input type="text" name="name" [(ngModel)]="candidateNodeName" />
    </div>
    <div class="app-modal-footer">
        <button type="button" class="btn btn-default" (click)="nodeRenameDialog.hide()">Cancel</button>
        <button type="button" class="btn btn-default" (click)="rename(selectedNodeAddress, candidateNodeName); nodeRenameDialog.hide()">Save</button>
    </div>
</app-dialog>

<app-dialog #nodeLimbDialog>
    <div class="app-modal-header">
        Node: <b>{{ selectedNodeAddress }}</b>
    </div>
    <div class="app-modal-body">
        Name <input type="text" name="limbName" [(ngModel)]="selectedLimb.name" /><br/>

        Parent Limb Name
        <select [(ngModel)]="selectedLimb.parentLimbName">
        <ng-template ngFor let-parent [ngForOf]="selectedLimb.potentialLimbs">
            <option [ngValue]="parent">{{ parent }}</option>
        </ng-template>
        </select><br/>

        Limb Model
        <select [(ngModel)]="selectedLimb.proposedLimbModel">
        <ng-template ngFor let-model [ngForOf]="knownModels" let-i="index">
            <option [ngValue]="model">{{ model }}</option>
        </ng-template>
        </select><br/>
        
        <input type="text" name="limbModel" [(ngModel)]="selectedLimb.proposedLimbModel" /><br/>
        length cm 
        <mat-slider min="1" max="50" step="0.5" value="30" tickInterval="5" thumbLabel (input)="adjustLimbLength(selectedNodeAddress, $event.value)"></mat-slider>
        <input type="text" name="limbLength" [(ngModel)]="selectedLimb.proposedLimbLength" /><br/>
    </div>
    <div class="app-modal-footer">
        <button type="button" class="btn btn-default" (click)="nodeLimbDialog.hide()">Cancel</button>
        <button type="button" class="btn btn-default" (click)="updateLimb(selectedNodeAddress); nodeLimbDialog.hide()">Save Values</button>
    </div>
</app-dialog>

<app-dialog #nodeRecordDialog>
    <div class="app-modal-header">
        Record Node: <b>{{ selectedNodeAddress }}</b>
    </div>
    <div class="app-modal-body">
        Record <input type="text" name="seconds" [(ngModel)]="recordSeconds" /> Seconds
    </div>
    <div class="app-modal-footer">
        <button type="button" class="btn btn-default" (click)="nodeRecordDialog.hide()">Cancel</button>
        <button type="button" class="btn btn-default" (click)="startRecordingNode(selectedNodeAddress); nodeRecordDialog.hide()">Record Data</button>
    </div>
</app-dialog>



